{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="card border-0 shadow-sm rounded-4 mb-4">
    <div class="card-body p-3">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label fw-bold text-muted small">Data Início</label>
                {{ form.data_inicio }}
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold text-muted small">Data Fim</label>
                {{ form.data_fim }}
            </div>
            <div class="col-md-4">
                <label class="form-label fw-bold text-muted small">Empresa</label>
                {{ form.empresa }}
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100 fw-bold">
                    <i class="bi bi-filter"></i> Filtrar
                </button>
            </div>
        </form>
    </div>
</div>

{% if not labels_atendimento %}
    <div class="alert alert-info text-center shadow-sm" role="alert">
        <i class="bi bi-info-circle-fill me-2"></i>
        Por favor, <strong>selecione uma Data de Início e Fim</strong> e clique em Filtrar para visualizar os indicadores.
    </div>
{% endif %}

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Tempo médio de atendimento por unidade(h)</p>
                    </div>
                </div>

                {% comment %} <div class="mb-4">
                    <span class="text-muted small">Performance da última campanha</span>
                </div> {% endcomment %}

                <div style="height: 250px; position: relative;">
                    <canvas id="chartAtendimentoMedio"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Tempo de Reparo x Tempo de Atendimento</p>
                    </div>
                </div>

                {% comment %} <div class="mb-4">
                    <span class="text-muted small">Performance da última campanha</span>
                </div> {% endcomment %}

                <div style="height: 250px; position: relative;">
                    <canvas id="chartScatterReparo"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Tempo Médio de Reparo por Unidade (dia)</p>
                    </div>
                </div>

                {% comment %} <div class="mb-4">
                    <span class="text-muted small">Status geral de conclusão</span>
                </div> {% endcomment %}

                <div style="height: 250px; position: relative;">
                    <canvas id="chartReparoMedio"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <h5 class="text-uppercase text-muted fw-bold small mb-3">
                    Quantidade de OS por Tipo de Manutenção
                </h5>
                <div style="height: 400px; position: relative;">
                    <canvas id="chartOsPorTipoManutencao"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Taxa de cumprimento de prev, calib, quali e TSE (%)</p>
                        {% comment %} <h3 class="fw-bold text-dark mb-0">87%</h3> {% endcomment %}
                    </div>
                    {% comment %} <div class="bg-danger bg-opacity-10 text-danger rounded-3 p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                        <i class="bi bi-check-circle fs-4"></i>
                    </div> {% endcomment %}
                </div>

                <div class="mb-4">
                    <span class="text-muted small">Status geral de conclusão</span>
                </div>

                <div style="height: 250px; position: relative;">
                    <canvas id="chartCumprimentoPrev"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Quantidade de OS planejadas já realizadas</p>
                    </div>
                </div>

                <div style="height: 250px; position: relative;">
                    <canvas id="chartQtdeOSPlanejdasRealizadas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Quantidade de OS planejadas não fechadas</p>
                    </div>
                </div>

                <div style="height: 250px; position: relative;">
                    <canvas id="chartQtdeOSPlanejdasNFechadas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Porcentagem de OS Planejadas Concluídas</p>
                    </div>
                </div>

                <div style="height: 250px; position: relative;">
                    <canvas id="chartPorcentagemOSPlanejadasConcluidas"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <p class="text-uppercase text-muted fw-bold small mb-1">Taxa de Disponibilidade Geral dos Equipamentos</p>
                    </div>
                </div>

                {% comment %} <div style="height: 250px; position: relative;">
                    <canvas id="chartTaxaDisponibilidadeEquipamentos"></canvas>
                </div> {% endcomment %}
                <div class="row g-4 mb-4" id="chartTaxaDisponibilidadeEquipamentos">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <h5 class="text-uppercase text-muted fw-bold small mb-3">
                    Qtde de Equipamentos Cadastrados por Unidade
                </h5>
                <p class="text-muted small mb-2">Filtro por Data de Cadastro</p>
                
                <div style="height: 300px; position: relative;">
                    <canvas id="chartQTDEquipamentosUnidade"></canvas>
                </div>
            </div>
        </div>
    </div>

    
</div>

<div class="row g-4 mb-4"> 
    <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <h5 class="text-uppercase text-muted fw-bold small mb-3">
                    Idade Média dos Equipamentos por Unidade (Anos)
                </h5>
                <div style="height: 250px; position: relative;">
                    <canvas id="chartIdadeMediaEquipamentosUnidade"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-body p-4">
                <h5 class="text-uppercase text-muted fw-bold small mb-3">
                    Idade dos Equipamentos por Família (Anos) - Top 20
                </h5>
                <div style="height: 350px; position: relative;">
                    <canvas id="chartIdadeFamiliaEquipamentos"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>


{{ labels_atendimento|json_script:"labels_atendimento" }}
{{ data_atendimento|json_script:"data_atendimento" }}

{{ dados_scatter|json_script:"dados_scatter" }}

{{ labels_reparo|json_script:"labels_reparo" }}
{{ data_reparo|json_script:"data_reparo" }}

{{ labels_taxa_cumprimento_medio|json_script:"labels_taxa_cumprimento_medio" }}
{{ data_taxa_cumprimento_medio|json_script:"data_taxa_cumprimento_medio" }}
{{ taxa_cumprimento_metadados|json_script:"taxa_cumprimento_metadados" }}

{{ labels_tipo_manutencao_os|json_script:"labels_tipo_manutencao_os" }}
{{ data_tipo_manutencao_os|json_script:"data_tipo_manutencao_os" }}

{{ labels_qtde_os_planejadas_realizadas|json_script:"labels_qtde_os_planejadas_realizadas" }}
{{ data_qtde_os_planejadas_realizadas|json_script:"data_qtde_os_planejadas_realizadas" }}

{{ labels_qtde_os_planejadas_n_realizadas|json_script:"labels_qtde_os_planejadas_n_realizadas" }}
{{ data_qtde_os_planejadas_n_realizadas|json_script:"data_qtde_os_planejadas_n_realizadas" }}


{{ labels_os_taxa_conclusao_planejamento|json_script:"labels_os_taxa_conclusao_planejamento" }}
{{ data_os_taxa_conclusao_planejamento|json_script:"data_os_taxa_conclusao_planejamento" }}
{{ plan_taxa_metadados|json_script:"plan_taxa_metadados" }}

{{ labels_disponibilidade_equipamentos|json_script:"labels_disponibilidade_equipamentos" }}
{{ data_disponibilidade_equipamentos|json_script:"data_disponibilidade_equipamentos" }}

{{ labels_equipamentos_unidade|json_script:"labels_equipamentos_unidade" }}
{{ data_equipamentos_unidade|json_script:"data_equipamentos_unidade" }}

{{ labels_idade_equipamentos_unidade|json_script:"labels_idade_equipamentos_unidade"}}
{{ data_idade_equipamentos_unidade|json_script:"data_idade_equipamentos_unidade"}}

{{ labels_idade_media_equipamentos_familia|json_script:"labels_idade_media_equipamentos_familia"}}
{{ data_idade_media_equipamentos_familia|json_script:"data_idade_media_equipamentos_familia"}}


<script src="{% static 'engenharia/js/dashboard_graficos_charts.js' %}"></script>
{% endblock %}